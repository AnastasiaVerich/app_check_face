(self.webpackChunkapp_check_face=self.webpackChunkapp_check_face||[]).push([[105],{291:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=291,e.exports=t},555:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var c=r(43),a=r(553),n=r(798),s=r(146),i=r(179),o=r(878),l=r(374),h=r(67),d=r(767),u=r(832);function x(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;const c=t.width*t.height;if(5*c<Math.PI*e.r*e.r)return!1;const a=function(e,t){const{cx:r,cy:c,r:a}=e,{x:n,y:s,width:i,height:o}=t,l=Math.min(i,o)/100;let h=0;for(let d=n;d<=n+i;d+=l)for(let e=s;e<=s+o;e+=l){const t=d-r,n=e-c;t*t+n*n<=a*a&&(h+=l*l)}return h}(e,t),n=a/c,s=t.x+t.width/2,i=t.y+t.height/2,o=s-e.cx,l=i-e.cy,h=o*o+l*l,d=h<=e.r*e.r,u=h<=e.r/4*(e.r/2);return n>=r&&d&&u}var f=r(579);const g=e=>{let{setPhotoUrl:t,streamRef:r,isCameraOn:g,setIsCameraOn:v,setError:m,videoBorderRef:w,videoRef:p,canvasRef:y}=e;const[k,j]=(0,c.useState)(!1),{isFaceDetected:_}=((e,t,r,a)=>{const[n,s]=(0,c.useState)(!1),[i,o]=(0,c.useState)(!1),[l]=(0,c.useState)(!1);return(0,c.useEffect)((()=>{(async()=>{await Promise.all([u.B0.tinyFaceDetector.loadFromUri("ia_models")]),o(!0)})()}),[]),(0,c.useEffect)((()=>{let c;return i&&e&&(c=setInterval((async()=>{if(t.current&&r.current&&a.current){const e=t.current,c=r.current,n=a.current,i={width:n.offsetWidth,height:n.offsetHeight};(0,u.L0)(c,i);const o=new u.ex({inputSize:416,scoreThreshold:.3}),h=await(0,u.R)(e,o),d=(0,u.Lz)(h,i);let f=null;if(l){if(f=c.getContext("2d"),!f)return;f.clearRect(0,0,c.width,c.height)}const g={cx:c.clientWidth/2,cy:c.clientHeight/2,r:150};let v=!1;d.forEach((e=>{const{x:t,y:r,width:a,height:n}=e.box,s=c.clientWidth-(t+a);v=x(g,{x:s,y:r,width:a,height:n},.8),l&&f&&(f.lineWidth=4,f.lineCap="square",f.lineJoin="bevel",f.strokeStyle="#5199d9",f.strokeRect(s,r,a,n))})),s(v),l&&f&&(f.beginPath(),f.arc(g.cx,g.cy,g.r,0,2*Math.PI),f.fillStyle="transparent",f.fill(),f.lineWidth=4,f.strokeStyle=v?"green":"red",f.stroke())}}),100)),()=>clearInterval(c)}),[i,e]),{isFaceDetected:n,modelsLoaded:i}})(g,p,y,w);(0,c.useEffect)((()=>{(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});r.current=e,p.current&&(p.current.srcObject=e),t(null),m(null)}catch(e){m("\u041e\u0448\u0438\u0431\u043a\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043a\u0430\u043c\u0435\u0440\u0435"),console.error(e)}})()}),[]);return(0,f.jsxs)(l.B,{max:!0,children:[(0,f.jsxs)(a.w,{className:"video_box "+(k?"":"hide"),children:[(0,f.jsx)("video",{className:"video_online",ref:p,playsInline:!0,autoPlay:!0,muted:!0,controls:!1,onLoadedMetadata:()=>{setTimeout((()=>{j(!0)}),0)}}),(0,f.jsx)("div",{ref:w,className:"video_box__wrapper"}),(0,f.jsx)("canvas",{ref:y,className:"canvas"}),(0,f.jsx)("div",{className:"face_overlay "+(_?"ok":"err")})]}),(0,f.jsx)(a.w,{max:!0,children:(0,f.jsx)(n.z,{max:!0,children:(0,f.jsx)(s.E,{text:i.kq,type:"text",max:!0})})}),(0,f.jsx)(a.w,{clickable:!0,max:!0,onClick:()=>{if(y.current&&p.current){const e=y.current,c=e.getContext("2d");c?(e.width=p.current.videoWidth,e.height=p.current.videoHeight,c.drawImage(p.current,0,0,e.width,e.height),t(e.toDataURL("image/jpeg"))):(t(null),r.current&&r.current.getTracks().forEach((e=>e.stop())))}else t(null),r.current&&r.current.getTracks().forEach((e=>e.stop()));v(!1)},disabled:!_,children:(0,f.jsxs)(n.z,{gap:"10",max:!0,children:[(0,f.jsx)(o.B,{Svg:h.h}),(0,f.jsx)(s.E,{text:i.xK,type:"text",max:!0}),(0,f.jsx)(o.B,{width:"12px",height:"12px",color:"subtitle",Svg:d.h})]})})]})}}}]);
//# sourceMappingURL=105.0ccaeb73.chunk.js.map